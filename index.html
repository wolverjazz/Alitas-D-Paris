<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alitas D'Paris - Pedidos</title>
    <link rel="icon" type="image/jpg" href="logo.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .product-card { border-radius: 2.5rem; }
        .active-cat { background: white !important; color: #ea580c !important; font-weight: bold; }
        .modal-active { display: flex !important; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        #seccion-impresion-final { display: none; }

        @media print {
            body * { visibility: hidden; height: 0; overflow: hidden; }
            #seccion-impresion-final, #seccion-impresion-final * { 
                visibility: visible; 
                display: block !important;
                height: auto !important;
                overflow: visible !important;
            }
            #seccion-impresion-final { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%;
                display: flex !important;
                justify-content: center !important;
                margin: 0;
                padding: 0;
            }
            @page { margin: 0; }
        }
    </style>
</head>
<body class="bg-gray-100 pb-32">

    <script>
        const CONFIG = {
            nombre: "ALITAS D'PARIS",           
            direccion: "MASCOTA #343, COL. JALISCO, TONAL√Å, JALISCO", 
            horario: "ABIERTO DE 4:00 PM A 11:00 PM",
            telefono: "Tel. 3315332223 / Whatsapp 3315332223",             
            whatsapp: "5213315332223",          
            color: "#ea580c",                   
            logoUrl: "logo.jpg", 
            claveCorte: "Paris2019"
        };

        const SALSAS_LISTA = ["BBQ", "B√öFALO HOT", "B√öFALO RAMS", "BBQ AHUMADO", "PARMESANO HOT", "PARMESANO AJO", "TERIYAKI", "JALAPE√ëO", "CHIPOTLE", "PI√ëA HOT", "MANGO HABANERO", "LIM√ìN PEPE", "MANGO DULCE", "HABANERO CON BARBECUE", "B√öFALO ESPECIAL"];

        const productos = [
            { id: 1, cat: "ALITAS", nombre: "Orden de 6 Alitas", desc: "+ aderezo, Salsa Extra $5", precio: 135, img: "https://i.postimg.cc/QNBH5vbr/alitas.jpg", tieneSabores: true },
            { id: 2, cat: "ALITAS", nombre: "Orden de 10 Alitas", desc: "+ aderezo, Salsa Extra $5", precio: 155, img: "https://i.postimg.cc/QNBH5vbr/alitas.jpg", tieneSabores: true },
            { id: 3, cat: "ALITAS", nombre: "Orden de 20 Alitas", desc: "+ aderezo, Salsa Extra $5", precio: 295, img: "https://i.postimg.cc/QNBH5vbr/alitas.jpg", tieneSabores: true },
            { id: 4, cat: "ALITAS", nombre: "Orden de 6 Alitas Con Papas", desc: "+ aderezo, Salsa Extra $5", precio: 150, img: "https://i.postimg.cc/QNBH5vbr/alitas.jpg", tieneSabores: true },
            { id: 5, cat: "ALITAS", nombre: "Orden de 10 Alitas Con Papas", desc: "+ aderezo, Salsa Extra $5", precio: 170, img: "https://i.postimg.cc/QNBH5vbr/alitas.jpg", tieneSabores: true },
            { id: 6, cat: "ALITAS", nombre: "Orden de 20 Alitas Con Papas", desc: "+ aderezo, Salsa Extra $5", precio: 320, img: "https://i.postimg.cc/QNBH5vbr/alitas.jpg", tieneSabores: true },
            { id: 7, cat: "PAPAS", nombre: "Papas a la Francesa (CH.)", desc: "", precio: 74, img: "https://i.postimg.cc/T2ZJFzYT/papas-a-la-francesa.jpg", tieneSabores: false },
            { id: 8, cat: "PAPAS", nombre: "Papas a la Francesa (M.)", desc: "", precio: 94, img: "https://i.postimg.cc/T2ZJFzYT/papas-a-la-francesa.jpg", tieneSabores: false },
            { id: 9, cat: "PAPAS", nombre: "Papas a la Francesa (G.)", desc: "", precio: 119, img: "https://i.postimg.cc/T2ZJFzYT/papas-a-la-francesa.jpg", tieneSabores: false },
            { id: 10, cat: "PAPAS", nombre: "Papas a la Francesa con Salchipulpos (CH.)", desc: "", precio: 74, img: "https://i.postimg.cc/pXSbwX5n/ppas-con-salchipulpos.jpg", tieneSabores: false },
            { id: 11, cat: "PAPAS", nombre: "Papas a la Francesa con Salchipulpos (M.)", desc: "", precio: 94, img: "https://i.postimg.cc/pXSbwX5n/ppas-con-salchipulpos.jpg", tieneSabores: false },
            { id: 12, cat: "PAPAS", nombre: "Papas a la Francesa con Salchipulpos (G.)", desc: "", precio: 119, img: "https://i.postimg.cc/pXSbwX5n/ppas-con-salchipulpos.jpg", tieneSabores: false },
            { id: 13, cat: "PAPAS", nombre: "Papas Gajo", desc: "", precio: 90, img: "https://i.postimg.cc/xC8PVYzQ/papas-gajo.jpg", tieneSabores: false },
            { id: 14, cat: "PAPAS", nombre: "Papas Par√≠s", desc: "", precio: 90, img: "https://i.postimg.cc/43SWdmZQ/papas-paris.jpg", tieneSabores: false },
            { id: 15, cat: "PAPAS", nombre: "Papas Curly", desc: "", precio: 90, img: "https://i.postimg.cc/43SWdmZQ/papas-paris.jpg", tieneSabores: false },
            { id: 16, cat: "PAPAS", nombre: "Salchitacos (CH.)", desc: "", precio: 84, img: "https://i.postimg.cc/pdH2SX3S/salchitacos.jpg", tieneSabores: false },
            { id: 17, cat: "PAPAS", nombre: "Salchitacos (M.)", desc: "", precio: 110, img: "https://i.postimg.cc/pdH2SX3S/salchitacos.jpg", tieneSabores: false },
            { id: 18, cat: "PAPAS", nombre: "Salchitacos (G.)", desc: "", precio: 129, img: "https://i.postimg.cc/pdH2SX3S/salchitacos.jpg", tieneSabores: false },
            { id: 19, cat: "PAPAS", nombre: "Salchicha, Papa y Taco (CH.)", desc: "", precio: 84, img: "https://i.postimg.cc/yNPXK34w/salchicha-taco-y-papa.jpg", tieneSabores: false },
            { id: 20, cat: "PAPAS", nombre: "Salchicha, Papa y Taco (M.)", desc: "", precio: 110, img: "https://i.postimg.cc/yNPXK34w/salchicha-taco-y-papa.jpg", tieneSabores: false },
            { id: 21, cat: "PAPAS", nombre: "Salchicha, Papa y Taco (G.)", desc: "", precio: 129, img: "https://i.postimg.cc/yNPXK34w/salchicha-taco-y-papa.jpg", tieneSabores: false },
            { id: 22, cat: "PAPAS", nombre: "Papa y Taco (CH.)", desc: "", precio: 84, img: "https://i.postimg.cc/y8ny4SzM/PAPA-Y-TACO.png", tieneSabores: false },
            { id: 23, cat: "PAPAS", nombre: "Papa y Taco (M.)", desc: "", precio: 110, img: "https://i.postimg.cc/y8ny4SzM/PAPA-Y-TACO.png", tieneSabores: false },
            { id: 24, cat: "PAPAS", nombre: "Papa y Taco (G.)", desc: "", precio: 129, img: "https://i.postimg.cc/y8ny4SzM/PAPA-Y-TACO.png", tieneSabores: false },
            { id: 25, cat: "PAPAS", nombre: "Taco y Salchicha (CH.)", desc: "", precio: 84, img: "https://i.postimg.cc/YCSmFn5t/TACO-Y-SALCHICHA.png", tieneSabores: false },
            { id: 26, cat: "PAPAS", nombre: "Taco y Salchicha (M.)", desc: "", precio: 110, img: "https://i.postimg.cc/YCSmFn5t/TACO-Y-SALCHICHA.png", tieneSabores: false },
            { id: 27, cat: "PAPAS", nombre: "Taco y Salchicha (G.)", desc: "", precio: 129, img: "https://i.postimg.cc/YCSmFn5t/TACO-Y-SALCHICHA.png", tieneSabores: false },
            { id: 28, cat: "MAS SNACK", nombre: "Boneless", desc: "", precio: 159, img: "https://i.postimg.cc/GtQgMx8g/boneless.jpg", tieneSabores: false },
            { id: 29, cat: "MAS SNACK", nombre: "Boneless con Papas", desc: "", precio: 179, img: "https://i.postimg.cc/DzJD2GDR/boneless-con-papas.jpg", tieneSabores: false },
            { id: 30, cat: "MAS SNACK", nombre: "Costilla", desc: "", precio: 159, img: "https://i.postimg.cc/P5h14v11/costillas.jpg", tieneSabores: false },
            { id: 31, cat: "MAS SNACK", nombre: "Costilla con Papas", desc: "", precio: 179, img: "https://i.postimg.cc/fL3dLchk/costilla-con-papas.jpg", tieneSabores: false },
            { id: 32, cat: "MAS SNACK", nombre: "Palomitas de Pollo", desc: "", precio: 85, img: "https://i.postimg.cc/hGYJHX7W/palomitas-de-pollo.jpg", tieneSabores: false },
            { id: 33, cat: "MAS SNACK", nombre: "Palomitas de Pollo con Papas", desc: "", precio: 120, img: "https://i.postimg.cc/76vH3022/palomitas-de-pollo-con-papas.jpg", tieneSabores: false },
            { id: 34, cat: "MAS SNACK", nombre: "Palomitas Mix", desc: "", precio: 349, img: "https://i.postimg.cc/8CvDzcnq/paloma-mix.jpg", tieneSabores: false },
            { id: 35, cat: "MAS SNACK", nombre: "Pechuga de pollo", desc: "a la manteqilla con hierbas finas", precio: 180, img: "https://i.postimg.cc/8CvDzcnq/paloma-mix.jpg", tieneSabores: false },
            { id: 36, cat: "PAPAS", nombre: "Salchitacos Individuales", desc: "", precio: 14, img: "https://i.postimg.cc/dQyWNdZH/salchitaco.jpg", tieneSabores: false },
            { id: 37, cat: "MAS SNACK", nombre: "Nachos", desc: "", precio: 90, img: "https://i.postimg.cc/SKPrDNSC/nachos.jpg", tieneSabores: false },
            { id: 38, cat: "MAS SNACK", nombre: "Aros de Cebolla", desc: "", precio: 80, img: "https://i.postimg.cc/s2MPQdpm/aros-de-cebolla.jpg", tieneSabores: false },
            { id: 39, cat: "MAS SNACK", nombre: "Dedos de Queso", desc: "", precio: 90, img: "https://i.postimg.cc/rsN5X8kw/dedos-de-queso.jpg", tieneSabores: false },
            { id: 40, cat: "MAS SNACK", nombre: "Nugget", desc: "", precio: 68, img: "https://i.postimg.cc/kGqtykbr/Nuggets-Pollo.jpg", tieneSabores: false },
            { id: 41, cat: "HAMBURGUESAS", nombre: "Hamburguesa de Res", desc: "", precio: 80, img: "https://i.postimg.cc/pL7fbW7V/hamburguesa-de-res.jpg", tieneSabores: false },
            { id: 42, cat: "HAMBURGUESAS", nombre: "Hamburguesa de Res con Papas", desc: "", precio: 95, img: "https://i.postimg.cc/T1YL5FSk/hamburguesa-de-res-con-papas.jpg", tieneSabores: false },
            { id: 43, cat: "HAMBURGUESAS", nombre: "Hamburguesa sencilla de Pollo", desc: "", precio: 80, img: "https://i.postimg.cc/63zTKzqx/hamburguesa-de-pollo.jpg", tieneSabores: false },
            { id: 44, cat: "HAMBURGUESAS", nombre: "Hamburguesa sencilla de Pollo con Papas", desc: "", precio: 95, img: "https://i.postimg.cc/3w130NTy/hamburguesa-de-pollo-con-papas.jpg", tieneSabores: false },
            { id: 45, cat: "HAMBURGUESAS", nombre: "Hamburguesa Boneless", desc: "", precio: 120, img: "https://i.postimg.cc/GmQpGqFV/hamburguesa-boneless.jpg", tieneSabores: false },
            { id: 46, cat: "HAMBURGUESAS", nombre: "Hamburguesa BBQ", desc: "", precio: 120, img: "https://i.postimg.cc/hP84Rp5T/hamburguesa-bbq.jpg", tieneSabores: false },
            { id: 47, cat: "HAMBURGUESAS", nombre: "Hamburguesa Especial", desc: "Sirloin + tocino, champis, pi√±a...", precio: 120, img: "https://i.postimg.cc/hP84Rp5T/hamburguesa-bbq.jpg", tieneSabores: false },
            { id: 48, cat: "HAMBURGUESAS", nombre: "Hamburguesa Jalape√±o", desc: "Pollo con jalape√±o impregnado", precio: 120, img: "https://i.postimg.cc/hP84Rp5T/hamburguesa-bbq.jpg", tieneSabores: false },
            { id: 49, cat: "HAMBURGUESAS", nombre: "6 K-Tiras", desc: "", precio: 220, img: "https://i.postimg.cc/ZRJ1kzC6/6-K-TIRAS.png", tieneSabores: false },
            { id: 50, cat: "HAMBURGUESAS", nombre: "9 K-Tiras", desc: "", precio: 310, img: "https://i.postimg.cc/3xKSJFK8/9-K-TIRAS.png", tieneSabores: false },
            { id: 51, cat: "COMBOS", nombre: "Pareja Par√≠s", desc: "10 alitas + boneless + papas + 2 Boing", precio: 420, img: "https://i.postimg.cc/44bRtc5q/pareja-paris.jpg", tieneSabores: false },
            { id: 52, cat: "COMBOS", nombre: "Mega Par√≠s", desc: "Todo incluido", precio: 899, img: "https://i.postimg.cc/wj5NY0cB/mega-paris.jpg", tieneSabores: false },
            { id: 53, cat: "COMBOS", nombre: "Gran Par√≠s", desc: "Mix completo", precio: 720, img: "https://i.postimg.cc/y8nFSLg6/gran-paris.jpg", tieneSabores: false },
            { id: 54, cat: "COMBOS", nombre: "Paloma Mix", desc: "Mini combo", precio: 720, img: "https://i.postimg.cc/cLDnJ62f/paloma-mix.jpg", tieneSabores: false },
            { id: 55, cat: "BEBIDAS", nombre: "Arizona", desc: "", precio: 35, img: "https://i.postimg.cc/P5Nq2y3B/arizona.jpg", tieneSabores: false },
            { id: 56, cat: "BEBIDAS", nombre: "Coca-Cola Taparrosca", desc: "", precio: 28, img: "https://i.postimg.cc/FsCrdcrG/coca.jpg", tieneSabores: false },
            { id: 57, cat: "BEBIDAS", nombre: "Jugo Boing", desc: "1/2 L.", precio: 28, img: "https://i.postimg.cc/90M3C87w/jugo-boing.jpg", tieneSabores: false },
            { id: 58, cat: "BEBIDAS", nombre: "Tonicol", desc: "", precio: 28, img: "https://i.postimg.cc/PxSc3WRN/tonicol.jpg", tieneSabores: false },
            { id: 59, cat: "BEBIDAS", nombre: "Sangr√≠a", desc: "", precio: 28, img: "https://i.postimg.cc/cCVF2XMZ/sangria.jpg", tieneSabores: false },
            { id: 60, cat: "EXTRAS", nombre: "RANCH", desc: "", precio: 25, img: "https://i.postimg.cc/Hx6qrL5S/ranch.jpg", tieneSabores: false },
            { id: 61, cat: "EXTRAS", nombre: "SALSAS", desc: "", precio: 25, img: "https://i.postimg.cc/wv1CspVx/salsas.jpg", tieneSabores: true },
            { id: 62, cat: "EXTRAS", nombre: "PAPAS GAJO", desc: "", precio: 25, img: "https://i.postimg.cc/FRvry1Yv/papas-gajo.jpg", tieneSabores: false },
	    { id: 63, cat: "EXTRAS", nombre: "Queso", desc: "", precio: 25, img: "https://i.postimg.cc/Px2H7PZH/unnamed-(13).png", tieneSabores: false },


        ];

        let salsasSeleccionadasTemp = {}; 
        let carrito = [];
        let catActual = 'TODOS';
        let importAutenticado = false; 

        window.onload = function() {
            document.getElementById('header-main').style.backgroundColor = CONFIG.color;
            document.getElementById('btn-revisar').style.backgroundColor = CONFIG.color;
            document.getElementById('logo-img').src = CONFIG.logoUrl;
            document.getElementById('view-nombre').innerText = CONFIG.nombre;
            document.getElementById('view-dir').innerText = CONFIG.direccion;
	    document.getElementById('view-hor').innerText = CONFIG.horario;
	    document.getElementById('view-tel').innerText = CONFIG.telefono;
	  
            renderMenu();
        };

        function filtrar(c) {
            catActual = c;
            document.querySelectorAll('header button').forEach(b => b.classList.remove('active-cat'));
            const btn = document.getElementById(`cat-${c}`);
            if(btn) btn.classList.add('active-cat');
            renderMenu();
        }

        function renderMenu() {
            const container = document.getElementById('menu-container');
            container.innerHTML = "";
            const filtrados = catActual === 'TODOS' ? productos : productos.filter(p => p.cat === catActual);
            filtrados.forEach(prod => {
                const card = document.createElement('div');
                card.className = "bg-white p-5 product-card shadow-sm border border-gray-50 flex flex-col gap-4";
                let saboresUI = prod.tieneSabores ? `
                    <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100">
                        <select onchange="seleccionarSalsa(${prod.id}, this.value)" class="w-full bg-white border border-gray-200 rounded-xl p-3 text-xs font-bold uppercase outline-none">
                            <option value="">Elegir salsa...</option>
                            ${SALSAS_LISTA.map(s => `<option value="${s}">${s}</option>`).join('')}
                        </select>
                        <div id="tags-salsas-${prod.id}" class="flex flex-wrap gap-2 mt-3"></div>
                    </div>` : "";
                card.innerHTML = `<div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gray-50 rounded-2xl flex items-center justify-center overflow-hidden border">
                            <img src="${prod.img}" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <h3 class="font-black text-gray-800 text-sm italic uppercase">${prod.nombre}</h3>
                            <p class="text-[10px] text-gray-400 font-bold">${prod.desc}</p>
                            <p class="font-black text-xl mt-1 italic" style="color:${CONFIG.color}">$${prod.precio}</p>
                        </div>
                        <button onclick="agregar(${prod.id})" class="text-white w-14 h-14 rounded-[1.5rem] flex items-center justify-center shadow-lg active:scale-90" style="background-color:${CONFIG.color}">
                            <i class="fas fa-plus text-xl"></i>
                        </button>
                    </div>${saboresUI}`;
                container.appendChild(card);
            });
        }

        function seleccionarSalsa(prodId, valor) {
            if (!valor) return;
            if (!salsasSeleccionadasTemp[prodId]) salsasSeleccionadasTemp[prodId] = [];
            if (!salsasSeleccionadasTemp[prodId].includes(valor)) {
                salsasSeleccionadasTemp[prodId].push(valor);
                actualizarTagsSalsas(prodId);
            }
        }

        function actualizarTagsSalsas(prodId) {
            const container = document.getElementById(`tags-salsas-${prodId}`);
            if(!container) return;
            container.innerHTML = "";
            (salsasSeleccionadasTemp[prodId] || []).forEach(s => {
                const tag = document.createElement('span');
                tag.className = "bg-white border text-[9px] font-bold px-3 py-1 rounded-full flex items-center gap-2 shadow-sm italic";
                tag.style.color = CONFIG.color; tag.style.borderColor = CONFIG.color;
                tag.innerHTML = `${s.toUpperCase()} <i class="fas fa-times cursor-pointer" onclick="quitarSalsaTemp(${prodId}, '${s}')"></i>`;
                container.appendChild(tag);
            });
        }

        function quitarSalsaTemp(prodId, valor) {
            salsasSeleccionadasTemp[prodId] = salsasSeleccionadasTemp[prodId].filter(s => s !== valor);
            actualizarTagsSalsas(prodId);
        }

        function agregar(id, cantidad = 1) {
    const prod = productos.find(p => p.id === id);
    let salsasFinales = null;
    let extraSalsas = 0;

    if (prod.tieneSabores) {
        const seleccionadas = salsasSeleccionadasTemp[id] || [];
        if (seleccionadas.length === 0) return alert("ELIGE AL MENOS UNA SALSA");
        
        // Si hay m√°s de 1 salsa, cada una extra cuesta $5
        if (seleccionadas.length > 1) {
            extraSalsas = (seleccionadas.length - 1) * 5;
        }
        
        salsasFinales = seleccionadas.join(", ");
    }

    // Calculamos el precio final con el extra
    const precioConExtra = prod.precio + extraSalsas;

    const index = carrito.findIndex(item => item.id === id && item.sabor === salsasFinales);
    
    if (index > -1) { 
        carrito[index].cant += cantidad; 
    } else { 
        // Guardamos el precio con el extra en el objeto del carrito
        carrito.push({ 
            ...prod, 
            precio: precioConExtra, // Aqu√≠ se sobreescribe el precio base
            sabor: salsasFinales, 
            cant: cantidad 
        }); 
    }

    if(prod.tieneSabores) { 
        salsasSeleccionadasTemp[id] = []; 
        actualizarTagsSalsas(id); 
    }
    actualizarBarra();
}

        function actualizarBarra() {
            const total = carrito.reduce((s, i) => s + (i.precio * i.cant), 0);
            document.getElementById('total-price').innerText = `$${total}`;
            document.getElementById('cart-bar').style.display = total > 0 ? 'block' : 'none';
        }

        function abrirModal() {
            const lista = document.getElementById('lista-carrito');
            lista.innerHTML = "";
            let total = 0;
            carrito.forEach((item, i) => {
                const sub = item.precio * item.cant;
                total += sub;
                lista.innerHTML += `
                    <div class="bg-gray-50 p-4 rounded-3xl border border-gray-100 flex justify-between items-center shadow-sm">
                        <div class="flex-1">
                            <p class="font-black text-gray-800 text-xs uppercase italic">${item.cant}x ${item.nombre}</p>
                            ${item.sabor ? `<p class="text-[9px] font-bold uppercase mt-1 italic" style="color:${CONFIG.color}">${item.sabor}</p>` : ''}
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="font-black text-gray-800 text-sm italic">$${sub}</span>
                            <button onclick="quitar(${i})" class="text-red-400 text-xl"><i class="fas fa-minus-circle"></i></button>
                        </div>
                    </div>`;
            });
            document.getElementById('total-modal').innerText = `$${total}`;
            document.getElementById('total-modal').style.color = CONFIG.color;
            document.getElementById('modal-carrito').classList.add('modal-active');
        }

        function quitar(index) {
            if(carrito[index].cant > 1) { carrito[index].cant--; } 
            else { carrito.splice(index, 1); }
            if (carrito.length === 0) cerrarModal();
            abrirModal();
            actualizarBarra();
        }

        function cerrarModal() { document.getElementById('modal-carrito').classList.remove('modal-active'); }

        function registrarVenta(nombre, domicilio, notas, total, detalleTexto) {
            let folio = parseInt(localStorage.getItem('folio_paris') || "0");
            let nuevoFolio = (folio === 0) ? 100 : folio + 100;
            localStorage.setItem('folio_paris', nuevoFolio);

            let historial = JSON.parse(localStorage.getItem('ventas_dia') || "[]");
            let nuevaVenta = { 
                folio: nuevoFolio, 
                cliente: nombre.toUpperCase(), 
                total: total, 
                detalle: detalleTexto, 
                domicilio: domicilio.toUpperCase(),
                notas: notas.toUpperCase(),
                items: JSON.parse(JSON.stringify(carrito)),
                fecha: new Date().toLocaleDateString(),
                hora: new Date().toLocaleTimeString()
            };
            historial.push(nuevaVenta);
            localStorage.setItem('ventas_dia', JSON.stringify(historial));
            return nuevaVenta;
        }


        // --- FUNCI√ìN UNIFICADA PARA REGISTRAR E IMPRIMIR ---
       function registrarYImprimir() {
    // 1. CAPTURAMOS los datos antes de que se borren
    const n = document.getElementById('c-nombre').value || "MOSTRADOR";
    const d = document.getElementById('c-dir').value || "RECOGE EN LOCAL";
    const notes = document.getElementById('c-notas').value || "";
    
    let esEnvio = d.toUpperCase().includes("ENV√çO");
    let subtotal = carrito.reduce((s, i) => s + (i.precio * i.cant), 0);
    let totalFinal = subtotal + (esEnvio ? 30 : 0);

    // 2. REGISTRAMOS la venta para el folio (100, 200, 300...) [cite: 2026-01-20]
    const venta = registrarVenta(n, d, notes, totalFinal, "");
    
    // Creamos una "foto" de los datos para la impresora [cite: 2026-01-23]
    const datosParaTicket = {
        ...venta,
        items: JSON.parse(JSON.stringify(venta.items)),
        total: totalFinal,
        notes: notes
    };

    // 3. ¬°FUERZA EL BORRADO AQU√ç! 
    // Limpiamos la web ANTES de que aparezca el cuadro de impresi√≥n
    carrito = []; 
    document.getElementById('c-nombre').value = "";
    document.getElementById('c-dir').value = "";
    document.getElementById('c-notas').value = "";
    
    // Cerramos el modal y quitamos la barra naranja de inmediato
    cerrarModal(); 
    actualizarBarra(); 

    // 4. MANDAMOS A IMPRIMIR
    // Usamos un peque√±o retraso de 200ms para que al ojo humano le d√© tiempo 
    // de ver que la pantalla ya se limpi√≥ antes de que salga el ticket.
    setTimeout(() => {
        imprimirTicketVenta(datosParaTicket);
        console.log("Sistema reseteado y folio nuevo listo");
    }, 200);
}

        function imprimirTicketVenta(v) {
    // Generamos el HTML con los precios unitarios
    let itemsHtml = v.items.map(i => `
        <div style="font-size:11px; border-bottom:1px dashed #ccc; padding:4px 0;">
            <div style="display: flex; justify-content: space-between; font-weight: bold;">
                <span>${i.cant}x ${i.nombre.toUpperCase()}</span>
                <span>$${i.precio}.00</span>
            </div>
            ${i.sabor ? '<div style="font-size:9px; font-style:italic;">SALSAS: ' + i.sabor.toUpperCase() + '</div>' : ''}
            <div style="text-align: right; font-size: 10px;">Sub: $${(i.precio * i.cant)}.00</div>
        </div>
    `).join('');

    const fechaTicket = new Date().toLocaleDateString();
    const horaTicket = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    // L√ìGICA DE ENV√çO: Calculamos el desglose para el ticket
    let esPedidoEnvio = v.domicilio.toUpperCase().includes("ENV√çO");
    let costoEnvio = esPedidoEnvio ? 30 : 0;
    let subtotalProductos = v.total - costoEnvio;

    document.getElementById('seccion-impresion-final').innerHTML = `
        <div style="width:58mm; margin:0 auto; font-family:monospace; text-align:center; padding:5px; background:white; color:black;">
            
            <img src="logo.jpg" style="width: 100px; height: auto; display: block; margin: 0 auto 5px auto;">
            
            <b style="font-size:16px;">${CONFIG.nombre}</b><br>
            <div style="font-size:9px; margin-top:2px;">
                ${CONFIG.direccion}<br>${CONFIG.horario}<br>${CONFIG.telefono}
            </div>
            ----------------------------<br>
            <div style="text-align:left; font-size:10px;">
                <b>FECHA:</b> ${fechaTicket} ${horaTicket}<br>
                <b>FOLIO: #${v.folio}</b><br>
                <b>CLIENTE:</b> ${v.cliente}<br>
                <b>ENTREGA:</b> ${v.domicilio}<br>
                ${v.notes ? '<b>NOTAS:</b> ' + v.notes.toUpperCase() + '<br>' : ''}
            </div>
            ----------------------------<br>
            ${itemsHtml}
            <div style="margin-top:10px; border-top: 1px solid #000; padding-top: 5px;">
                
                ${esPedidoEnvio ? `
                <div style="display: flex; justify-content: space-between; font-size: 11px;">
                    <span>PRODUCTOS:</span>
                    <span>$${subtotalProductos}.00</span>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 11px;">
                    <b>ENV√çO:</b>
                    <b>$${costoEnvio}.00</b>
                </div>
                <div style="border-top: 1px dashed #ccc; margin: 4px 0;"></div>
                ` : ''}

                <div style="display: flex; justify-content: space-between; font-size: 14px;">
                    <b>TOTAL:</b>
                    <b>$${v.total}.00</b>
                </div>
            </div>
            <br><span style="font-size:10px;">¬°GRACIAS POR SU PREFERENCIA!</span>
        </div>`;
    
    window.print();
}

function finalizarVentaYLimpiar() {
    carrito = [];
    document.getElementById('c-nombre').value = "";
    document.getElementById('c-dir').value = "";
    document.getElementById('c-notas').value = "";
    cerrarModal();
    actualizarBarra();
    console.log("Sistema Alitas D'Paris: Carrito limpio y folio liberado.");
}


        // Modifica tu bot√≥n de "Imprimir" en el HTML para que llame a: registrarYImprimir()
        function toggleImportar() {
            if(!importAutenticado) {
                const pass = prompt("ACCESO A IMPORTAR:");
                if(pass !== CONFIG.claveCorte) return alert("ERROR");
                importAutenticado = true;
            }
            const area = document.getElementById('import-area');
            area.classList.toggle('hidden');
        }

        // --- L√ìGICA DE DETECCI√ìN MEJORADA ---
        function procesarPegado() {
    const texto = document.getElementById('input-import').value;
    if (!texto) return alert("Pega el pedido de WhatsApp");

    // 1. CAPTURAR FOLIO DE WHATSAPP [cite: 2026-01-20]
    const matchFolio = texto.match(/#\s*(\d+)/);
    let folioWA = matchFolio ? matchFolio[1] : "---";

    // 2. EXTRAER DATOS DEL CLIENTE
    const matchNombre = texto.match(/CLIENTE:\s*(.*)/i);
    const matchDireccion = texto.match(/ENTREGA:\s*(.*)/i);
    const matchNotas = texto.match(/NOTAS:\s*(.*)/i);

    if (matchNombre) document.getElementById('c-nombre').value = matchNombre[1].trim();
    if (matchDireccion) document.getElementById('c-dir').value = matchDireccion[1].trim();
    
    // 3. SEPARAR FOLIO Y NOTAS EN RENGLONES DISTINTOS [cite: 2026-01-23]
    // Usamos \n para bajar las notas a un nuevo rengl√≥n
    let textoNotasFinal = "FOLIO WHATSAPP: #" + folioWA; 
    if (matchNotas && matchNotas[1].trim() !== "") {
        textoNotasFinal += "\nNOTAS: " + matchNotas[1].trim(); // El \n hace que la nota baje
    }
    document.getElementById('c-notas').value = textoNotasFinal;

    // 4. PROCESAR PRODUCTOS Y EVITAR DOBLE ENV√çO [cite: 2026-01-23]
    const lineas = texto.split('\n');
    carrito = []; 

    for (let i = 0; i < lineas.length; i++) {
        let linea = lineas[i].replace(/[^\x20-\x7E]/g, '').trim(); 
        const matchProd = linea.match(/^(\d+)\s*[xX]\s*(.+)/);
        
        if (matchProd) {
            const cantidad = parseInt(matchProd[1]);
            let nombreProd = matchProd[2].split(/SUB:|[\$]/i)[0].trim();
            
            // Si la l√≠nea detectada es el env√≠o del texto de WhatsApp, la ignoramos
            if (nombreProd.toUpperCase().includes("ENV√çO") || nombreProd.toUpperCase().includes("ENVIO")) {
                continue; 
            }

            let precioUnitario = 0;
            let bloquePrecio = linea + " " + (lineas[i+1] || "") + " " + (lineas[i+2] || "");
            const matchPrecio = bloquePrecio.match(/\$\s*(\d+)/);
            if (matchPrecio) precioUnitario = parseFloat(matchPrecio[1]) / cantidad;

            if (lineas[i+1] && lineas[i+1].toUpperCase().includes("SALSAS:")) {
                nombreProd += " (" + lineas[i+1].trim() + ")";
            }

            carrito.push({
                nombre: nombreProd.toUpperCase(),
                precio: precioUnitario,
                cant: cantidad,
                id: "WA_" + Date.now() + i
            });
        }
    }

    // 5. CARGO DE ENV√çO √öNICO [cite: 2026-01-23]
    const necesitaEnvio = texto.toUpperCase().includes("(ENV√çO)") || texto.toUpperCase().includes("ENV√çO: $");
    if (necesitaEnvio && typeof agregarEnvioManual === 'function') {
        carrito = carrito.filter(p => !p.nombre.includes("ENV√çO")); // Limpieza de seguridad
        agregarEnvioManual(); 
    }

    actualizarBarra();
    abrirModal();
    document.getElementById('input-import').value = "";
}

        let corteAutenticado = false;
        function verCorte() {
            if (!corteAutenticado) {
                const pass = prompt("CONTRASE√ëA DE ACCESO:");
                if (pass !== CONFIG.claveCorte) {
                    return alert("ERROR: CONTRASE√ëA INCORRECTA");
                }
                corteAutenticado = true;
            }
            let historial = JSON.parse(localStorage.getItem('ventas_dia') || "[]");
            let total = 0;
            const container = document.getElementById('corte-detalle');
            container.innerHTML = "";
            historial.forEach((v, idx) => {
                total += v.total;
                container.innerHTML += `
                    <div class="flex justify-between items-center border-b py-2">
                        <div>
                            <p class="font-black">#${v.folio} - ${v.cliente}</p>
                            <p class="text-[9px] text-gray-400">${v.hora} | ${v.detalle.substring(0,30)}...</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="font-bold">$${v.total}</span>
                            <button onclick="imprimirExistente(${idx})" class="text-blue-500 px-2"><i class="fas fa-print"></i></button>
                        </div>
                    </div>`;
            });
            document.getElementById('corte-total').innerText = `TOTAL: $${total}`;
            document.getElementById('fecha-corte').innerText = new Date().toLocaleDateString();
            document.getElementById('modal-corte').classList.remove('hidden');
            document.getElementById('modal-corte').classList.add('flex');
        }

        function imprimirExistente(index) {
            let historial = JSON.parse(localStorage.getItem('ventas_dia') || "[]");
            imprimirTicketVenta(historial[index]);
        }

        function cerrarCorte() { 
            document.getElementById('modal-corte').classList.add('hidden'); 
            document.getElementById('modal-corte').classList.remove('flex');
        }

        function limpiarVentas() {
            if(confirm("¬øBORRAR TODAS LAS VENTAS DEL D√çA?")) {
                localStorage.setItem('ventas_dia', "[]");
                cerrarCorte();
            }
        }

        function mandarImprimirCorte() {
            let historial = JSON.parse(localStorage.getItem('ventas_dia') || "[]");
            let t = 0;
            let listaVentas = historial.map(v => {
                t += v.total;
                let itemsList = v.items.map(it => ` - ${it.cant} ${it.nombre}`).join('<br>');
                return `<div style="text-align:left; border-bottom:1px solid #000; padding:4px 0;">
                            <b>#${v.folio} - ${v.cliente}</b> ($${v.total})<br>
                            <div style="font-size:9px;">${itemsList}</div>
                        </div>`;
            }).join('');
            
            document.getElementById('seccion-impresion-final').innerHTML = `
                <div style="width:58mm; margin:0 auto; font-family:monospace; text-align:center; padding:5px; background:white;">
                    <b>CORTE DE CAJA</b><br>
                    <span>${new Date().toLocaleDateString()}</span><br><br>
                    ${listaVentas}
                    <br><b style="font-size:14px;">TOTAL D√çA: $${t}.00</b>
                </div>
            `;
            setTimeout(() => { window.print(); }, 150);
        }

	function aplicarEnvioMoto() {
    const campoDir = document.getElementById('c-dir');
    
    // Si el campo no tiene la palabra ENV√çO, se la agregamos al final sin borrar la direcci√≥n
    if (!campoDir.value.includes("(ENV√çO)")) {
        campoDir.value = campoDir.value + " (ENV√çO)";
    }

    let subtotalProductos = carrito.reduce((total, p) => total + (p.precio * p.cant), 0);
    let totalConEnvio = subtotalProductos + 30;

    // Actualizamos el total visual en el modal
    const displayTotal = document.getElementById('total-modal');
    if (displayTotal) {
        displayTotal.innerText = `$${totalConEnvio}`;
    }
}

// --- ESTO ACTIVA EL BOT√ìN DE WHATSAPP ---
function enviarPedido() {
    // 1. CAPTURA DE DATOS
    const n = document.getElementById('c-nombre').value || "MOSTRADOR";
    const d = document.getElementById('c-dir').value || "LOCAL";
    const notes = document.getElementById('c-notas').value; 
    
    const fecha = new Date().toLocaleDateString();
    const hora = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    let subtotal = carrito.reduce((s, i) => s + (i.precio * i.cant), 0);
    let esEnvio = d.toUpperCase().includes("ENV√çO");
    let envio = esEnvio ? 30 : 0;
    let totalFinal = subtotal + envio;

    // 2. REGISTRO DE VENTA (Folios 100, 200, 300...)
    const venta = registrarVenta(n, d, notes, totalFinal, "");

    // 3. CONSTRUCCI√ìN DEL MENSAJE CON INFO DE LA EMPRESA
    let msg = `*${CONFIG.nombre}*\n`;
    msg += `üìç ${CONFIG.direccion}\n`;
    msg += `üïí ${CONFIG.horario}\n`;
    msg += `üìû ${CONFIG.telefono}\n`;
    msg += `------------------------------\n`;
    msg += `*üöÄ PEDIDO #${venta.folio}*\n`;
    msg += `üìÖ *FECHA:* ${fecha} - ${hora}\n`; 
    msg += `üë§ *CLIENTE:* ${venta.cliente}\n`;
    msg += `üìç *ENTREGA:* ${venta.domicilio}\n`;
    
    if (notes) {
        msg += `üìù *NOTAS:* ${notes.toUpperCase()}\n`;
    }
    
    msg += `------------------------------\n`;
    
    venta.items.forEach(item => {
        msg += `‚úÖ *${item.cant}x* ${item.nombre}\n${item.sabor ? '    _Salsas: '+item.sabor+'_\n' : ''}    Sub: $${item.precio * item.cant}\n\n`;
    });

    if(esEnvio) {
        msg += `------------------------------\n*SUBTOTAL: $${subtotal}*\n*üõµ ENV√çO: $30*\n`;
    }
    
    msg += `*TOTAL: $${totalFinal}.00*\n`;
    msg += `------------------------------\n`;
    msg += `_¬°Gracias por su preferencia!_`;

    // 4. ENV√çO Y LIMPIEZA TOTAL
    const url = `https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(msg)}`;
    
    // Abrimos WhatsApp
    const win = window.open(url, '_blank');
    if (win) win.focus();

    // Ejecutamos la limpieza (Borra campos y reinicia folio)
    finalizarVentaYLimpiar(); 
}
</script>

    <header class="text-white p-8 pb-12 text-center rounded-b-[3rem] shadow-xl relative" id="header-main">
        <div class="max-w-4xl mx-auto">
            <div class="w-24 h-24 bg-black rounded-full border-4 border-white/20 overflow-hidden shadow-2xl mx-auto mb-4">
                <img id="logo-img" src="" class="w-full h-full object-cover"> 
            </div>
            <h1 class="text-2xl md:text-4xl font-black uppercase italic" id="view-nombre"></h1>
            <p class="text-[10px] md:text-xs opacity-90 mt-1 italic" id="view-dir"></p>
 	   <h2 class="text-2xl md:text-4xl font-black uppercase italic" id="view-horario"></h2>
            <p class="text-[10px] md:text-xs opacity-90 mt-1 italic" id="view-hor"></p>
	   <h3 class="text-2xl md:text-4xl font-black uppercase italic" id="view-telefono"></h3>
            <p class="text-[10px] md:text-xs opacity-90 mt-1 italic" id="view-tel"></p>
	   
           
            <div class="mt-4 flex justify-center gap-3">
                <button onclick="verCorte()" class="bg-white/10 hover:bg-white/30 p-3 rounded-full transition-all border border-white/10 shadow-lg">
                    <i class="fas fa-lock text-white text-sm"></i>
                </button>
                <button onclick="toggleImportar()" class="bg-green-500 hover:bg-green-600 p-3 rounded-full transition-all border border-white/10 shadow-lg">
                    <i class="fas fa-file-import text-white text-sm"></i>
                </button>
            </div>

            <div id="import-area" class="mt-4 hidden animate-pulse">
                <textarea id="input-import" class="w-full h-24 rounded-2xl p-4 text-gray-800 text-xs font-bold outline-none uppercase" placeholder="PEGA AQU√ç TU LISTA (EJ: 2 ORDEN DE ALITAS BBQ)"></textarea>
                <button onclick="procesarPegado()" class="w-full bg-white text-green-600 font-black py-3 rounded-2xl mt-2 shadow-lg italic">CARGAR CARRITO</button>
            </div>

            <div class="flex gap-2 overflow-x-auto no-scrollbar mt-8 py-2">
                <button id="cat-TODOS" onclick="filtrar('TODOS')" class="active-cat px-6 py-2 rounded-full border border-white/20 text-[10px] uppercase">TODOS</button>
                <button id="cat-ALITAS" onclick="filtrar('ALITAS')" class="px-6 py-2 rounded-full border border-white/20 text-[10px] uppercase">ALITAS</button>
                <button id="cat-PAPAS" onclick="filtrar('PAPAS')" class="px-6 py-2 rounded-full border border-white/20 text-[10px] uppercase">PAPAS</button>
                <button id="cat-MAS SNACK" onclick="filtrar('MAS SNACK')" class="px-6 py-2 rounded-full border border-white/20 text-[10px] uppercase">MAS SNACK</button>
                <button id="cat-HAMBURGUESAS" onclick="filtrar('HAMBURGUESAS')" class="px-6 py-2 rounded-full border border-white/20 text-[10px] uppercase">HAMBURGUESAS</button>
                <button id="cat-COMBOS" onclick="filtrar('COMBOS')" class="px-6 py-2 rounded-full border border-white/20 text-[10px] uppercase">COMBOS</button>
                <button id="cat-BEBIDAS" onclick="filtrar('BEBIDAS')" class="px-6 py-2 rounded-full border border-white/20 text-[10px] uppercase">BEBIDAS</button>
                <button id="cat-EXTRAS" onclick="filtrar('EXTRAS')" class="px-6 py-2 rounded-full border border-white/20 text-[10px] uppercase">EXTRAS</button>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 -mt-8">
        <div id="menu-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </main>

    <div id="cart-bar" class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-lg hidden z-50">
        <button id="btn-revisar" onclick="abrirModal()" class="w-full text-white py-5 rounded-[2.5rem] shadow-2xl flex justify-between items-center px-8 active:scale-95 transition-all">
            <span class="font-black italic text-lg tracking-widest uppercase">REVISAR PEDIDO</span>
            <span id="total-price" class="bg-white/20 px-5 py-2 rounded-2xl font-black text-xl italic">$0</span>
        </button>
    </div>

    <div id="modal-carrito" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] hidden items-end md:items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-[3rem] p-8 max-h-[90vh] overflow-y-auto relative no-scrollbar">
            <button onclick="cerrarModal()" class="absolute top-6 right-6 text-gray-300 text-3xl"><i class="fas fa-times-circle"></i></button>
            <h2 class="text-3xl font-black italic uppercase mb-8 text-gray-800">Tu Pedido</h2>
            <div id="lista-carrito" class="flex flex-col gap-4"></div>
            
            <div class="mt-8 border-t-4 border-dashed pt-8">
                <div class="grid grid-cols-1 gap-4 mb-6">
                    <input id="c-nombre" type="text" placeholder="TU NOMBRE" class="bg-gray-50 border-none rounded-2xl p-4 font-bold text-sm uppercase outline-none">
                    <input type="text" id="c-dir" placeholder="DOMICILIO / REFERENCIA / COSTO $30" oninput="actualizarTotalConEnvio()">
                    <textarea id="c-notas" placeholder="NOTAS EXTRAS" class="bg-gray-50 border-none rounded-2xl p-4 font-bold text-sm uppercase outline-none"></textarea>
                </div>
                <div class="flex justify-between items-center mb-8">
                    <span class="font-black text-gray-400 italic text-xl">PAGAS:</span>
                    <span id="total-modal" class="font-black text-4xl italic">$0</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
    <button onclick="registrarYImprimir()" class="bg-gray-800 text-white p-5 rounded-3xl font-black italic uppercase flex flex-col items-center justify-center text-[10px]">
        <i class="fas fa-print mb-1 text-xl"></i>
        SOLO IMPRIMIR
    </button>
    
    <button onclick="aplicarEnvioMoto()" class="bg-orange-600 text-white p-5 rounded-3xl font-black italic uppercase flex flex-col items-center justify-center text-[10px]">
        <i class="fas fa-motorcycle mb-1 text-xl"></i>
        ENV√çO (+$30)
    </button>

    <button onclick="enviarPedido()" class="bg-green-500 text-white p-5 rounded-3xl font-black italic uppercase flex flex-col items-center justify-center text-[10px]">
        <i class="fab fa-whatsapp mb-1 text-xl"></i>
        MANDAR WHATSAPP
    </button>
</div>
            </div>
        </div>
    </div>

    <div id="modal-corte" class="fixed inset-0 bg-black/80 backdrop-blur-md z-[200] hidden items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-[3rem] p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-black italic">CORTE DE CAJA</h2>
                <span id="fecha-corte" class="text-xs font-bold text-gray-400"></span>
            </div>
            <div id="corte-detalle" class="max-h-64 overflow-y-auto no-scrollbar mb-6"></div>
            <div id="corte-total" class="text-2xl font-black text-right mb-8">TOTAL: $0</div>
            <div class="grid grid-cols-1 gap-3">
                <button onclick="mandarImprimirCorte()" class="bg-blue-600 text-white font-black py-4 rounded-2xl italic uppercase text-xs">IMPRIMIR CORTE</button>
                <button onclick="limpiarVentas()" class="bg-red-500 text-white font-black py-4 rounded-2xl italic uppercase text-xs">LIMPIAR TODO EL D√çA</button>
                <button onclick="cerrarCorte()" class="bg-gray-200 text-gray-600 font-black py-4 rounded-2xl italic uppercase text-xs">CERRAR</button>
            </div>
        </div>
    </div>

    <div id="seccion-impresion-final"></div>

</body>
</html>